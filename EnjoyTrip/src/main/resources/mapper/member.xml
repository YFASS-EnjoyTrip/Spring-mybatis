<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.ssafy.enjoytrip.member.model.mapper.MemberMapper">

	<select id="selectMemberIdByEmail" parameterType="string" resultType="string">
		SELECT member_id
		  FROM member
         WHERE email = #{email};
	</select>

	<select id="findMemberByEmail" parameterType="memberDto" resultType="memberDto">
		SELECT member_id, email, password, nickname, profile_img, bio
		  FROM member
		 WHERE email = #{email}
	</select>

	<select id="findMemberById" parameterType="string" resultType="memberDto">
		SELECT member_id, email, password, nickname, profile_img, bio
		FROM member
		WHERE member_id = #{memberId}
	</select>

	<select id="selectMemberByCheck" parameterType="string"
		resultType="memberInfoDto">
		SELECT *
		  FROM member
		 WHERE email=#{check}
		    OR nickname=#{check}
	</select>
	<select id="selectLike" parameterType="String"
		resultType="HashMap">
		    SELECT l.type, m.nickname,
		      CASE
		      WHEN l.type = 'H' THEN h.place_title
		      WHEN l.type = 'A' THEN a.title
		      WHEN l.type = 'P' THEN p.title
	        END AS title
		      FROM tb_like l
	    INNER JOIN member m ON l.member_id = m.member_id
		 LEFT JOIN hot_place_board h ON l.type = 'H' AND l.item_id = h.id
		 LEFT JOIN attraction_info a ON l.type = 'A' AND l.item_id = a.content_id
		 LEFT JOIN travel_plan p ON l.type = 'P' AND l.item_id = p.travle_plan_id
		     WHERE m.nickname = #{nickname}
	</select>

	<insert id="insertMember" parameterType="memberDto">
		INSERT INTO member(
		    		`email`, `password`, `nickname`
		)    VALUES (
		             #{email}, #{password}, #{nickname}
		)
	</insert>
	<delete id="deleteMember" parameterType="memberDto">
		DELETE
		  FROM member
		 WHERE email = #{email}
	</delete>
	<select id="selectHotPlaceByEmail" parameterType="string"
		resultType="hotPlaceDto">
		SELECT h.*, m.nickname
		  FROM hot_place_board h, member m
		 WHERE h.member_id=m.member_id
		   AND m.email=#{email}
	</select>
	<update id="updateMemberPassword" parameterType="map">
		UPDATE member
		SET password = #{password}
		WHERE nickname = #{nickname}
	</update>
	<update id="updateMemberBio" parameterType="map">
		UPDATE member
		   SET bio = #{bio}
		 WHERE email = #{email}
	</update>

	<update id="updateMemberProfileImg" parameterType="map">
		UPDATE member
		   SET profile_img = #{image}
		 WHERE email = #{email}
	</update>

	<update id="saveRefreshToken" parameterType="map">
		UPDATE member
           SET token = #{token}
    	 WHERE email = #{email}
	</update>
</mapper>